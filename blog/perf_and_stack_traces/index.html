<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> Perf and stack traces &middot; Marko Kevac home </title>

  
  <link rel="stylesheet" href="http://mkevac.github.io/kevac.org/css/poole.css">
  <link rel="stylesheet" href="http://mkevac.github.io/kevac.org/css/syntax.css">
  <link rel="stylesheet" href="http://mkevac.github.io/kevac.org/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Marko Kevac home" />
</head>

<body>

<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>Marko Kevac home</h1>
      <p class="lead">
      An elegant open source and mobile first theme for <a href="http://hugo.spf13.com">hugo</a> made by <a href="http://twitter.com/mdo">@mdo</a>. Originally made for Jekyll.
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/">Home</a> </li>
      
    </ul>

    <p>&copy; 2014. All rights reserved. </p>
  </div>
</div>


    <div class="content container">
<div class="post">
  <h1>Perf and stack traces</h1>
  <span class="post-date">Thu, Jun 19, 2014</span>
      <p>I was wondering why perf record -g don&rsquo;t show proper stack traces for my programs in production environment.
First I thought that kernel was too old, but after performing few experiments I have found out that it wasn&rsquo;t the case.
Problem was that when you compile with optimizations (-O3), gcc automatically omits frame pointers.
And it is not easy to unwind stack traces without frame pointers. But gcc can do it somehow.
So I have continued digging and stumbled upon article where people bash one of the perf authors for not
being able to unwind stacks without frame pointers.</p>

<p>If you read thoroughly you can find out that gcc uses DWARF debugging information for stack unwinding,
but it&rsquo;s too slow for profilers.</p>

<p>So I wanted to know how much slower would my programs be if I include frame pointers.
And seems that performance losses are
<a href="http://dom.as/2009/07/26/on-binaries-and-fomit-frame-pointer/">negligible</a>:</p>

<blockquote>
<p>I tested two MySQL builds, one built with ‘-O3 -g -fno-omit-frame-pointer’ and other with
-fomit-frame-pointer instead – and performance difference was negligible. It was around 1%
in sysbench tests, and slightly over 3% at tight-loop select
benchmark(100000000,(select asin(5+5)+sin(5+5))); on a 2-cpu Opteron box.</p>
</blockquote>

<p>So I will try including frame pointers from now on. To include them, use -fno-omit-frame-pointers gcc parameter when building executable.</p>

<p>If you are interested what frame pointers are and how they work, I would recommend reading answer to this stackoverflow question.</p>

</div>
</div>

  </body>
</html>
